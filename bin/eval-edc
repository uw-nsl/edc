#! /usr/bin/env python3
from __future__ import annotations

from argparse import ArgumentParser
from textwrap import dedent

from edc.data import evaluate_preds

def main():
    # CLI arguments parser
    parser = ArgumentParser(description="evaluate dialog state predictions")
    # Add CLI arguments
    parser.add_argument(
        "-d", "--dataset", required=True, help="path to TOD dataset archive"
    )
    parser.add_argument(
        "-p", "--prediction", required=True,
        help="path to dialog state prediction archive"
    )
    parser.add_argument(
        "-s", "--subset", default="dev", choices=["train", "dev", "test"],
        help="subset of given datasets for prediction"
    )
    # Parse CLI arguments
    args = parser.parse_args()

    # Evaluate predictions
    eval_result = evaluate_preds(args.dataset, args.prediction, args.subset)
    # Print evaluation results
    print(dedent(f"""\
    >>>>> DST Evaluation <<<<<

    [DST Metrics]
    * # of rounds: {eval_result['n_rounds']}
    * # of correct rounds: {eval_result['n_correct_rounds']}
    * Joint accuracy: {eval_result['joint_accuracy']}

    [Incorrect Examples]
    (TBD)
    """))

if __name__=="__main__":
    main()
